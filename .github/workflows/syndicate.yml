name: "Syndication"

on:
  workflow_dispatch:
    branches:
      - master
  schedule:
    - cron: '*/15 14 * * *'

jobs:
  syndicate:
    name: "Post Jobs"
    runs-on: ubuntu-latest

    steps:
    - name: "Check out repository"
      uses: actions/checkout@v3

    - uses: ruby/setup-ruby@v1
      with:
        bundler-cache: true

    - run: bundle install

    - run: ruby main.rb
      env:
        SYN_ENV: test
        TD_SLACK_WEBHOOK: ${{ secrets.TD_SLACK_WEBHOOK }}
        TW_TDJOBS_APIKEY: ${{ secrets.TW_TDJOBS_APIKEY }}
        TW_TDJOBS_APISECRET: ${{ secrets.TW_TDJOBS_APISECRET }}
        TW_TDJOBS_APIBEARER: ${{ secrets.TW_TDJOBS_APIBEARER }}
        TW_TDJOBS_ACTOKEN: ${{ secrets.TW_TDJOBS_ACTOKEN }}
        TW_TDJOBS_ACSECRET: ${{ secrets.TW_TDJOBS_ACSECRET }}
        TW_TDJOBS_CLIENTID: ${{ secrets.TW_TDJOBS_CLIENTID }}
        TW_TDJOBS_CLIENTSECRET: ${{ secrets.W_TDJOBS_CLIENTSECRET }}

    - name: "Upload jobs DB"
      uses: actions/upload-artifact@v3
      with:
        name: jobs-db
        path: ./jobs.sqlite
        if-no-files-found: error